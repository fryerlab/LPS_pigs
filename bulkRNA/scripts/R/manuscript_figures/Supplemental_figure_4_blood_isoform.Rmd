---
title: "Figure_blood"
author: "Kimberly Olney"
date: "06/15/2022"
output: html_document
---

Main figure showing blood results

```{r setup, include=FALSE}
knitr::opts_knit$set(root.dir = ".")
```

May to unload all packages 
lapply(paste('package:',names(sessionInfo()$otherPkgs),sep=""),detach,character.only=TRUE,unload=TRUE)
```{r packages}
library(gprofiler2)
library(DESeq2)
library(enrichplot)
library(DOSE) 
library(plyr)
library(ggplot2)
require(gridExtra)
library(forcats)
library(UpSetR)
library(ComplexUpset)
library(ggplot2movies)
library(gtools)
library(ggnewscale)
library(ggrepel)
library(patchwork)
require(gridExtra)
library(ggpubr)
library(scales)
library("wiggleplotr")
library("dplyr")
library("GenomicRanges")
library("GenomicFeatures")
library("biomaRt")
library(tidyverse)
library(sleuth)
library(ggtranscript)
library(magrittr)
library(dplyr)
```

# User defined variables
```{r set_variables}
tissue <- "Blood"
control <- "Saline"
treatment <- "LPS"
control_color <- "gray65"
treatment_color <- "purple"
pathToRef <- c("/research/labs/neurology/fryer/projects/references/pig/ensembl_v7/")
```
# Save functions
These functions with help simultaneously save plots as a png, pdf, and tiff 
file.
```{r}
saveToPDF <- function(...) {
    d = dev.copy(pdf,...)
    dev.off(d)
}
```

# Binary list shared gene function
```{r}
fromList <- function (input) {
  # Same as original fromList()...
  elements <- unique(unlist(input))
  data <- unlist(lapply(input, function(x) {
      x <- as.vector(match(elements, x))
      }))
  data[is.na(data)] <- as.integer(0)
  data[data != 0] <- as.integer(1)
  data <- data.frame(matrix(data, ncol = length(input), byrow = F))
  data <- data[which(rowSums(data) != 0), ]
  names(data) <- names(input)
  # ... Except now it conserves your original value names!
  row.names(data) <- elements
  return(data)
  }
```

```{r}
addSmallLegend <- function(myPlot, pointSize = 3, textSize = 6, spaceLegend = .5) {
    myPlot +
        guides(shape = guide_legend(override.aes = list(size = pointSize)),
               color = guide_legend(override.aes = list(size = pointSize))) +
        theme(legend.title = element_text(size = textSize), 
              legend.text  = element_text(size = textSize),
              legend.key.size = unit(spaceLegend, "lines"))
}
```

# Isoform-level
### Volcano plot 
```{r}
tool <- c("kallisto") # salmon or kallisto
isoformDE <-
  readRDS(paste0(
    "../../../rObjects/",
    treatment,
    "_",
    tool,
    "_",
    tolower(tissue),
    "_sleuth.rds"
  ))

sleuth_table_wt <-
  read.delim(
    paste0(
      "../../../results/",
      tool,
      "/DEGs/",
      treatment,
      "_",
      tissue,
      "_isoform_DEGs_FDRq1.0.txt"
    )
  )

# significant DEGs
sleuth_significant <- dplyr::filter(sleuth_table_wt, qval <= 0.05)
# remove enteries with NA
sleuth_table_wt <- sleuth_table_wt[!is.na(sleuth_table_wt$qval), ]

color_values <- vector()
max <- nrow(sleuth_table_wt)

for (i in 1:max) {
  if (sleuth_table_wt$qval[i] < 0.05) {
    if (sleuth_table_wt$b[i] > 0) {
      color_values <-
        c(color_values, 1) # 1 when logFC > 0 and FDRq < 0.05
    }
    else if (sleuth_table_wt$b[i] < 0) {
      color_values <-
        c(color_values, 2) # 2 when logFC < 0 and FDRq < 0.05
    }
  }
  else{
    color_values <- c(color_values, 3) # 3 when FDRq >= 0.05
  }
}

# check
sleuth_table_wt$color_p0.05 <- factor(color_values)
sleuth_table_wt$gene_name <-
  as.character(sleuth_table_wt$gene_name)
up <- sleuth_table_wt[sleuth_table_wt$color_p0.05 == 1, ]
up10 <- up[1:4, ]
goiARHGEF10L <- sleuth_table_wt[sleuth_table_wt$gene_name == "ARHGEF10L", ]
goiCCR2 <- sleuth_table_wt[sleuth_table_wt$gene_name == "CCR2", ]
goiEVI5 <- sleuth_table_wt[sleuth_table_wt$gene_name == "EVI5", ]
goiICAM2 <- sleuth_table_wt[sleuth_table_wt$gene_name == "ICAM2", ]


down <- sleuth_table_wt[sleuth_table_wt$color_p0.05 == 2, ]
down10 <- down[1:3, ]

hadjpval <- (-log10(max(sleuth_table_wt$pval[sleuth_table_wt$qval < 0.05],
                        na.rm = TRUE)))
```

```{r}
isoform_volcano <- ggplot(data = sleuth_table_wt,
         aes(
           x = b,
           y = -log10(pval),
           color = color_p0.05
         )) + 
  geom_point(alpha = 0.5, size = 1.7) + 
  theme_bw() +  
  theme(legend.position = "none") +  
  scale_color_manual(values = c("red", "blue", "grey")) + 
  labs(
    x = expression(log[2](FC)),
    y = expression(-log[10] ~ "(" ~ italic("p") ~ "-value)")) +
    theme(plot.margin = margin(0.1, 0.2, 0, 0.2, "cm"), 
      axis.title.x = element_text(size = 6),
      axis.text.x = element_text(size = 6)
    ) +
      theme(
        axis.title.y = element_text(size = 6),
        axis.text.y = element_text(size = 6)
      ) +
      geom_hline(
        yintercept = hadjpval,
        #  horizontal line
        colour = "#000000",
        linetype = "dashed"
      ) +
      ggtitle(paste0(tissue, "\nFDRq < 0.05")) +
         theme(plot.title = element_text(size = 7, margin = margin(0,0,0,0))) +
      geom_text_repel(
        data = up10,
        aes(
          x = b,
          y = -log10(pval),
          label = gene_name
        ),
        color = "maroon",
        fontface = "italic",
        size = 2,
        min.segment.length = unit(0, 'lines'),
        nudge_x = .25,
        max.overlaps = getOption("ggrepel.max.overlaps", default = 30)
      ) +
      geom_text_repel(
        data = down10,
        aes(
          x = b,
          y = -log10(pval),
          label = gene_name
        ),
        color = "navyblue",
        fontface = "italic",
        size = 2,
        min.segment.length = unit(0, 'lines'),
       # nudge_x = -.25,
       # nudge_y = .25,
        max.overlaps = getOption("ggrepel.max.overlaps", default = 15)
      )  +
        geom_text_repel(
        data = goiCCR2,
        aes(
          x = b,
          y = -log10(pval),
          label = gene_name
        ),
        color = c("navyblue","navyblue", "maroon", "maroon"),
        fontface = "italic",
        size = 2,
        min.segment.length = unit(0, 'lines'),
        nudge_x = c(-.5, -.5, -.5, -.5),
        nudge_y = c(.5, .5, -1, 1),
        max.overlaps = getOption("ggrepel.max.overlaps", default = 15)
      )  +
        geom_text_repel(
        data = goiEVI5,
        aes(
          x = b,
          y = -log10(pval),
          label = gene_name
        ),
        color = c( "maroon", "maroon", "navyblue"),
        fontface = "italic",
        size = 2,
        min.segment.length = unit(0, 'lines'),
        nudge_x = c(0, 1, -1),
        nudge_y = c(1, 2, -4),
        max.overlaps = getOption("ggrepel.max.overlaps", default = 15)
      )  +
      scale_y_continuous(breaks = seq(0, 175, by = 25), limits = c(0, 165)) +
     scale_x_continuous(breaks = seq(-8, 10, by = 2), limits = c(-8, 10)
      )
isoform_volcano

```
### Upset
```{r}
star_blood <-
  read.delim(
    "../../../results/star/DEGs/LPS_Blood_gene_DEGs_FDRq0.05.txt",
    header = TRUE,
    sep = "\t"
  )
kallisto_blood <-
  read.delim(
    "../../../results/kallisto/DEGs/LPS_Blood_isoform_DEGs_FDRq0.05.txt",
    header = TRUE,
    sep = "\t"
  )

up_star_blood <- subset(star_blood$gene_name, star_blood$logFC > 0)
down_star_blood <-
  subset(star_blood$gene_name, star_blood$logFC < 0)

up_kallisto_blood <-
  subset(kallisto_blood$gene_name, kallisto_blood$b > 0)
down_kallisto_blood <-
  subset(kallisto_blood$gene_name, kallisto_blood$b < 0)

up_genes <- intersect(up_star_blood, up_kallisto_blood)
down_genes <- intersect(down_star_blood, down_kallisto_blood)
# blood
blood_input <- list(
  "gene down-regulated" = down_star_blood,
  "gene up-regulated" = up_star_blood,
  "isoform down-regulated" = down_kallisto_blood,
  "isoform up-regulated" = up_kallisto_blood
)
blood_data <- fromList(blood_input)

blood_upset <- upset(
  blood_data,
  c(
    'isoform down-regulated',
    'gene down-regulated',
    'isoform up-regulated',
    'gene up-regulated'
  ), themes=upset_modify_themes(
        list('intersections_matrix'=theme(text=element_text(size=7)),
          'overall_sizes' = theme(axis.text.x = element_text(size =7)))),
  queries = list(
    upset_query(set = 'gene up-regulated', fill = 'red'),
    upset_query(set = 'isoform up-regulated', fill ='red'),
    upset_query(set = 'gene down-regulated', fill = 'blue'),
    upset_query(set = 'isoform down-regulated', fill = 'blue'),
    upset_query(
      intersect = c('gene up-regulated', 'isoform up-regulated'),
      color = 'red',
      fill = 'red',
      only_components = c('intersections_matrix', 'Intersection size')
    ),
    upset_query(
      intersect = c('gene down-regulated', 'isoform down-regulated'),
      color = 'blue',
      fill = 'blue',
      only_components = c('intersections_matrix', 'Intersection size')
    )
  ),
  intersections = list(
    c('gene down-regulated', 'isoform down-regulated'),
    'gene down-regulated',
    'isoform down-regulated',
    c('gene up-regulated', 'isoform up-regulated'),
    'gene up-regulated',
    'isoform up-regulated',
    c('isoform up-regulated', 'isoform down-regulated'),
    c('gene down-regulated', 'isoform up-regulated'),
    c('gene up-regulated', 'isoform down-regulated')
  ),
  base_annotations=list(
    'Intersection size'=(
        intersection_size(
        size=1,
        text = list(size = 2.25),
        text_mapping = aes(),
        bar_number_threshold=1,  # show all numbers on top of bars
        width=0.3,   # reduce width of the bars
        mapping=aes(fill='bars_color')
      )
      + scale_fill_manual(values=c('grey'), guide='none')
      + scale_y_continuous(expand=expansion(mult=c(0, 0.1)))
      + theme(axis.text.y = element_text(size = 6),
              axis.title.y = element_text(size = 6),
          panel.grid.major=element_blank(),
          panel.grid.minor=element_blank(),
          axis.line=element_line(colour='black')))),
  matrix=intersection_matrix(
      geom=geom_point(
        shape='circle filled',
        size=2,
        stroke=0.45)) +
        theme(axis.text.y = element_text(size = 6),
              axis.title.y = element_text(size = 6)),
  set_sizes=(
    upset_set_size(geom=geom_bar(width=0.4), position="right")
    + theme(axis.line.x=element_line(colour='black'), 
            axis.text.x = element_text(angle = 45, hjust = 1, size = 6),
            axis.title.x = element_text(size = 7),
            axis.ticks.x=element_line())),
  sort_sets=FALSE,
  sort_intersections=FALSE) 

blood_upset 
```
### GTF 
```{r}
# Read in GTF and ensembl Sscrofa object
# read in annotation file
gtf.file <- paste0(pathToRef, "Sus_scrofa.Sscrofa11.1.107.gtf")
gtf.gr <- rtracklayer::import(gtf.file)
# save gtf as data frame
gtf.df <- as.data.frame(gtf.gr)
```
### Isoform expression data
```{r}
# this is the same as the isoform_bias_table
all_iso_sig_genes <-
  sleuth_table_wt[sleuth_table_wt$gene_name %in% sleuth_significant$gene_name,]
all_iso_genes <-
  sleuth_table_wt[sleuth_table_wt$gene_name %in% sleuth_table_wt$gene_name,]
so <-
  readRDS(
    paste0(
      "../../../rObjects/",
      treatment,
      "_",
      tool,
      "_",
      tolower(tissue),
      "_sleuth.rds"
    )
  )
data_tpm <-
  sleuth_to_matrix(so, which_df = "obs_norm", which_units = "est_counts")
data_tpm_reorder <- data_tpm[, c(6, 7, 8, 9, 1, 2, 5, 10, 3, 4)]
dim(data_tpm_reorder)

all_iso_sig_genes <- all_iso_sig_genes %>%
  mutate(label = case_when(qval > 0.05 ~ "NS",
                           qval < 0.05 ~ "*",
                           TRUE ~ NA_character_))

all_iso_genes <- all_iso_genes %>%
  mutate(label = case_when(qval > 0.05 ~ "NS",
                           qval < 0.05 ~ "*",
                           TRUE ~ NA_character_))
# function calculate the mean and sd for each group (LPS and saline) for each isoform
data_summary <- function(data, varname, groupnames) {
  require(plyr)
  summary_func <- function(x, col) {
    c(mean = mean(x[[col]], na.rm = TRUE),
      sd = sd(x[[col]], na.rm = TRUE))
  }
  data_sum <- ddply(data, groupnames, .fun = summary_func,
                    varname)
  return(data_sum)
}
```
### Bar plots of TMP and log2FC & transcript plot
#### AGO3
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "AGO3")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <- 
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}

df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

AGO3_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey", "grey", "grey")) +
  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-3, 3, by = 1), limits = c(-3, 3)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("AGO3 fold change")
AGO3_logFC

# bar plot
AGO3_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("AGO3 expression")
AGO3_tmp_bar

# extract exons
AGO3_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "AGO3")
AGO3_exons <- subset(AGO3_exons, transcript_id %in% goi_iso_box$transcript_id)

AGO3_transcript <- AGO3_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(AGO3_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
   scale_fill_manual(values = c("black")) +
  ggtitle("AGO3 transcripts") +
  xlab("chromosome 6")
AGO3_transcript
```
#### AMN1
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "AMN1")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

AMN1_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("AMN1 fold change")
AMN1_logFC

# bar plot
AMN1_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("AMN1 expression")
AMN1_tmp_bar

# extract exons
AMN1_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "AMN1")
AMN1_exons <- subset(AMN1_exons, transcript_id %in% goi_iso_box$transcript_id)

AMN1_transcript <- AMN1_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(AMN1_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("AMN1 transcripts") +
  xlab("chromosome 5")
AMN1_transcript
```
#### ANKRD28
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "ANKRD28")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

ANKRD28_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("ANKRD28 fold change")
ANKRD28_logFC

# bar plot
ANKRD28_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("ANKRD28 expression")
ANKRD28_tmp_bar

# extract exons
ANKRD28_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "ANKRD28")
ANKRD28_exons <- subset(ANKRD28_exons, transcript_id %in% goi_iso_box$transcript_id)

ANKRD28_transcript <- ANKRD28_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(ANKRD28_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("ANKRD28 transcripts") +
  xlab("chromosome 5")
ANKRD28_transcript
```
#### ANXA6
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "ANXA6")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

ANXA6_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("ANXA6 fold change")
ANXA6_logFC

# bar plot
ANXA6_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("ANXA6 expression")
ANXA6_tmp_bar

# extract exons
ANXA6_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "ANXA6")
ANXA6_exons <- subset(ANXA6_exons, transcript_id %in% goi_iso_box$transcript_id)

ANXA6_transcript <- ANXA6_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(ANXA6_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("ANXA6 transcripts") +
  xlab("chromosome 5")
ANXA6_transcript
```
#### ARHGEF10L
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "ARHGEF10L")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

ARHGEF10L_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-4, 6, by = 2), limits = c(-4, 6)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("ARHGEF10L fold change")
ARHGEF10L_logFC

# bar plot
ARHGEF10L_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("ARHGEF10L expression")
ARHGEF10L_tmp_bar

# extract exons
ARHGEF10L_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "ARHGEF10L")
ARHGEF10L_exons <- subset(ARHGEF10L_exons, transcript_id %in% goi_iso_box$transcript_id)

ARHGEF10L_transcript <- ARHGEF10L_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(ARHGEF10L_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("ARHGEF10L transcripts") +
  xlab("chromosome 6")
ARHGEF10L_transcript
```
#### B4GALT6
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "B4GALT6")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

B4GALT6_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("B4GALT6 fold change")
B4GALT6_logFC

# bar plot
B4GALT6_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("B4GALT6 expression")
B4GALT6_tmp_bar

# extract exons
B4GALT6_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "B4GALT6")
B4GALT6_exons <- subset(B4GALT6_exons, transcript_id %in% goi_iso_box$transcript_id)

B4GALT6_transcript <- B4GALT6_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(B4GALT6_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("B4GALT6 transcripts") +
  xlab("chromosome 5")
B4GALT6_transcript
```
#### CCR2
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "CCR2")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

CCR2_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-4, 6, by = 2), limits = c(-4, 6)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("CCR2 fold change")
CCR2_logFC

# bar plot
CCR2_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("CCR2 expression")
CCR2_tmp_bar

# extract exons
CCR2_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "CCR2")
CCR2_exons <- subset(CCR2_exons, transcript_id %in% goi_iso_box$transcript_id)

CCR2_transcript <- CCR2_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(CCR2_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("CCR2 transcripts") +
  xlab("chromosome 13")
CCR2_transcript
```
#### CYFIP1
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "CYFIP1")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

CYFIP1_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("CYFIP1 fold change")
CYFIP1_logFC

# bar plot
CYFIP1_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("CYFIP1 expression")
CYFIP1_tmp_bar

# extract exons
CYFIP1_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "CYFIP1")
CYFIP1_exons <- subset(CYFIP1_exons, transcript_id %in% goi_iso_box$transcript_id)

CYFIP1_transcript <- CYFIP1_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(CYFIP1_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("CYFIP1 transcripts") +
  xlab("chromosome 5")
CYFIP1_transcript
```
#### EVI5
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "EVI5")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

EVI5_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-4, 6, by = 2), limits = c(-4, 6)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("EVI5 fold change")
EVI5_logFC

# bar plot
EVI5_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("EVI5 expression")
EVI5_tmp_bar

# extract exons
EVI5_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "EVI5")
EVI5_exons <- subset(EVI5_exons, transcript_id %in% goi_iso_box$transcript_id)

EVI5_transcript <- EVI5_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(EVI5_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("EVI5 transcripts") +
  xlab("chromosome 4")
EVI5_transcript
```
#### ICAM2
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "ICAM2")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

ICAM2_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-4, 6, by = 2), limits = c(-4, 6)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("ICAM2 fold change")
ICAM2_logFC

# bar plot
ICAM2_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("ICAM2 expression")
ICAM2_tmp_bar

# extract exons
ICAM2_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "ICAM2")
ICAM2_exons <- subset(ICAM2_exons, transcript_id %in% goi_iso_box$transcript_id)

ICAM2_transcript <- ICAM2_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(ICAM2_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("ICAM2 transcripts") +
  xlab("chromosome 12")
ICAM2_transcript
```
#### NUP155
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "NUP155")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

NUP155_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("NUP155 fold change")
NUP155_logFC

# bar plot
NUP155_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("NUP155 expression")
NUP155_tmp_bar

# extract exons
NUP155_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "NUP155")
NUP155_exons <- subset(NUP155_exons, transcript_id %in% goi_iso_box$transcript_id)

NUP155_transcript <- NUP155_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(NUP155_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("NUP155 transcripts") +
  xlab("chromosome 5")
NUP155_transcript
```
#### SF1
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "SF1")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

SF1_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("SF1 fold change")
SF1_logFC

# bar plot
SF1_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("SF1 expression")
SF1_tmp_bar

# extract exons
SF1_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "SF1")
SF1_exons <- subset(SF1_exons, transcript_id %in% goi_iso_box$transcript_id)

SF1_transcript <- SF1_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(SF1_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("SF1 transcripts") +
  xlab("chromosome 5")
SF1_transcript
```
#### SLC14A1
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "SLC14A1")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

SLC14A1_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("SLC14A1 fold change")
SLC14A1_logFC

# bar plot
SLC14A1_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("SLC14A1 expression")
SLC14A1_tmp_bar

# extract exons
SLC14A1_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "SLC14A1")
SLC14A1_exons <- subset(SLC14A1_exons, transcript_id %in% goi_iso_box$transcript_id)

SLC14A1_transcript <- SLC14A1_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(SLC14A1_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("SLC14A1 transcripts") +
  xlab("chromosome 5")
SLC14A1_transcript
```
#### SLC25A6
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "SLC25A6")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

SLC25A6_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("SLC25A6 fold change")
SLC25A6_logFC

# bar plot
SLC25A6_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("SLC25A6 expression")
SLC25A6_tmp_bar

# extract exons
SLC25A6_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "SLC25A6")
SLC25A6_exons <- subset(SLC25A6_exons, transcript_id %in% goi_iso_box$transcript_id)

SLC25A6_transcript <- SLC25A6_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(SLC25A6_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("SLC25A6 transcripts") +
  xlab("chromosome 5")
SLC25A6_transcript
```
#### SLTM
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "SLTM")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

SLTM_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("SLTM fold change")
SLTM_logFC

# bar plot
SLTM_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("SLTM expression")
SLTM_tmp_bar

# extract exons
SLTM_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "SLTM")
SLTM_exons <- subset(SLTM_exons, transcript_id %in% goi_iso_box$transcript_id)

SLTM_transcript <- SLTM_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(SLTM_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("SLTM transcripts") +
  xlab("chromosome 5")
SLTM_transcript
```
#### YLPM1
```{r}
goi_iso_box <- subset(all_iso_genes, gene_name == "YLPM1")

# get the bootstrap values for each sample for each isoform of the gene of interest
tpm_target_id_df <- NULL
for (i in goi_iso_box$target_id) {
  tmp_per_target <-
    get_bootstrap_summary(so, target_id = i, units = "est_counts")
  tmp_per_target$target_id <- i
  tpm_target_id_df <- rbind(tpm_target_id_df, tmp_per_target)
}
df_TPM_goi <- data_summary(
  tpm_target_id_df,
  varname = "mid",
  groupnames = c("condition", "target_id")
)
# Convert to a factor variable
df_TPM_goi$target_id = as.factor(df_TPM_goi$target_id)
df_TPM_goi$condition <- factor(df_TPM_goi$condition, levels = c("LPS", "Control"))

YLPM1_logFC <-
  ggplot(goi_iso_box, aes(x = b, y = transcript_id, fill = color_p0.05)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  theme_classic() +
  scale_fill_manual(values = c("red", "blue", "grey")) +

  labs(x = expression(log[2](FC))) +
  theme_bw() + theme(legend.position = "none") +
  theme(axis.title.y = element_blank())  +
  scale_x_continuous(breaks = seq(-8, 8, by = 2), limits = c(-7, 7)) +
  geom_vline(xintercept = 0,
             color = "black",
             size = .5) +
  theme(axis.text.y = element_blank(), 
        axis.text.x = element_text(size = 6),
        axis.title.x = element_text(size = 6), 
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        plot.margin = margin(.1,.2,.1,0, "cm")) +
  ggtitle("YLPM1 fold change")
YLPM1_logFC

# bar plot
YLPM1_tmp_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "bootstrap estimated counts", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "none") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("YLPM1 expression")
YLPM1_tmp_bar

# extract exons
YLPM1_exons <- gtf.df %>% dplyr::filter(type == "exon" & gene_name == "YLPM1")
YLPM1_exons <- subset(YLPM1_exons, transcript_id %in% goi_iso_box$transcript_id)

YLPM1_transcript <- YLPM1_exons %>%
  ggplot(aes(
    xstart = start,
    xend = end,
    y = transcript_id
  )) +
  geom_range(
    aes(fill = transcript_biotype)
  ) +
  geom_intron(
    arrow = arrow(angle = 10, length = unit(0.0, "inches")),
    data = to_intron(YLPM1_exons, "transcript_name"),
    aes(strand = strand)
  ) + theme_classic() +
  theme_bw() +
  theme(
    strip.text = element_text(size = 6),
    legend.position = "none",
    panel.background = element_blank(),
    panel.spacing = unit(0,'lines'), 
    plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
    axis.title.x=element_text(size = 6),
    axis.text.x = element_text(size = 6), 
    axis.title.y = element_blank(), 
    axis.text.y = element_text(size = 6, margin = margin(r = -1)),
    plot.margin = margin(.15,0,.1,.15, "cm"),
    axis.ticks.y=element_blank()) +
    scale_fill_manual(values = c("black")) +
  ggtitle("YLPM1 transcripts") +
  xlab("chromosome 5")
YLPM1_transcript
```
### Get legend information
```{r}
# bar plot
legend_tpm_bar <-
  ggplot(df_TPM_goi, aes(x = mean, y = target_id, fill = condition)) +
  geom_bar(
    stat = "identity",
    color = "black",
    width = .7,
    position = position_dodge()
  ) +
  geom_errorbar(aes(xmin = mean - sd, xmax = mean + sd),
                width = .2,
                position = position_dodge(width = .7)) +
  labs(x = "TPM", y = "") +
  theme_classic() +
  scale_fill_manual(values = c(treatment_color, control_color)) +
  theme_bw() + 
  theme(legend.position = "bottom", legend.justification = "right") +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.text.x = element_text(size = 6),
        plot.title = element_text(size = 7, margin = margin(0,0,0,0)),
        axis.title.x = element_text(size = 6), 
        plot.margin = margin(.1,0,.1,0, "cm")) +
  ggtitle("SOCS3 expression") + scale_color_discrete(name="")
legend_tpm_bar_small <- addSmallLegend(legend_tpm_bar) +
  theme(legend.title=element_blank(),
      legend.margin = margin(0.1, 0.1, 0.1, 0.1),
      legend.spacing.x = unit(0.5, "mm"),
      legend.spacing.y = unit(0.1, "mm"))
# Extract the legend. Returns a gtable
leg <- get_legend(legend_tpm_bar_small)
# Convert to a ggplot and print
legendonly_tpm_bar <- as_ggplot(leg)

text = paste("* qval <= 0.05")
FC_legend <- ggplot() + 
  annotate("text", x = 4, y = 25, size=2.25, label = text) + 
  theme_void()
FC_legend
```
# Combine all plots 
```{r}
rowVol <- ggarrange(
  isoform_volcano,
  blood_upset,
  ncol = 2,
  labels = c("a)", "b)"),
  widths = c(1, 1.5), 
  font.label = list(size = 8)
  )

rowTransLeg <- ggarrange(
  NULL, 
  legendonly_tpm_bar, 
  FC_legend, 
  ncol = 3, 
  widths = c(2.25, 1, 1)
)

rowARHGEF10L <- ggarrange(
  ARHGEF10L_transcript, 
  ARHGEF10L_tmp_bar, 
  ARHGEF10L_logFC, 
  ncol = 3,
  labels = c("c)", "", ""),
  widths = c(2.25, 1, 1),
  font.label = list(size = 8)
  )

rowCCR2 <- ggarrange(
  CCR2_transcript, 
  CCR2_tmp_bar, 
  CCR2_logFC, 
  ncol = 3,
  labels = c("d)", "", ""),
  widths = c(2.25, 1, 1),
  font.label = list(size = 8)
  )

rowEVI5 <- ggarrange(
  EVI5_transcript, 
  EVI5_tmp_bar, 
  EVI5_logFC, 
  ncol = 3,
  labels = c("e)", "", ""),
  widths = c(2.25, 1, 1),
  font.label = list(size = 8)
  )

rowICAM2 <- ggarrange(
  ICAM2_transcript, 
  ICAM2_tmp_bar, 
  ICAM2_logFC, 
  ncol = 3,
  labels = c("f)", "", ""),
  widths = c(2.25, 1, 1),
  font.label = list(size = 8)
  )

combind <-
  ggarrange(
    rowVol,
    rowTransLeg,
    rowARHGEF10L,
    rowCCR2,
    rowEVI5,
    rowICAM2,
    nrow = 6,
    heights = c(1.25, .06, .45, .5, .45, .5)
  )
combind

path <- paste0("../../../results/manuscript_figures/Supplemental_figure_",
               tolower(tissue),
               "_isoform_level")
saveToPDF(paste0(path, ".pdf"), width = 7.08, height = 8.66)
```

# Session information
```{r}
session_info()
```
